<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://leighton.digital/essential_audio.css">
    <title>sound and vision</title>
    <style>
        /* Custom styles here */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: white;
            color: black;
        }
        .track-control {
            cursor: pointer;
            background: none;
            border: none;
            padding: 5px 10px;
            user-select: none;
        }
        #random-media {
            width: 100%;
            height: 90vh;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }
    </style>
</head>
<body>

<div id="random-media"></div>

<div class="essential_audio" id="player-container">
    <!-- Player Button -->
    <div>
        <div class="off"></div> <!-- This div will change class based on player state -->
    </div>
    <!-- Track -->
    <div>
        <div></div> <!-- This div represents the loading progress bar -->
    </div>
    <!-- Click & Drag Sensor -->
    <div></div>
</div>

<button class="track-control" onclick="nextTrack()">CHANGE YOUR TUNE</button>

<script src="https://leighton.digital/essential_audio.js"></script>
<script>
    // Arrays of MP3 and image files retrieved from the spreadsheet
    var mp3Files = [/* 1500 mp3 files listed here */]; // Replace with the actual MP3 array
    var imageFiles = [/* 1500 images listed here */]; // Replace with the actual image array

    var currentTrackIndex = 0;

    function getRandomItem(array) {
        return array[Math.floor(Math.random() * array.length)];
    }

    function setTrack(index) {
        // Wrap around the index if it goes out of bounds
        currentTrackIndex = (index + mp3Files.length) % mp3Files.length;
        var track = mp3Files[currentTrackIndex];

        // Since the new player handles its own audio element, we retrieve it through its API
        var audioPlayer = Essential_Audio.Audio[currentTrackIndex];
        if (audioPlayer) {
            audioPlayer.src = track;
            audioPlayer.play();
        }

        // Update the background image
        var randomImage = getRandomItem(imageFiles);
        document.getElementById('random-media').style.backgroundImage = 'url(' + randomImage + ')';
    }

    function nextTrack() {
        // Select a random index from the mp3Files array
        var randomIndex = Math.floor(Math.random() * mp3Files.length);

        // Set the track to the randomly selected index
        setTrack(randomIndex);
    }

    // Set random media on page load
    window.onload = function() {
        Essential_Audio.init(); // Ensure the Essential Audio Player is initialized
        nextTrack();
    };

    // Since the Essential Audio Player might handle its own 'ended' event,
    // you'll need to check if you should still use this or if the player has a way to handle it.
    // document.getElementById('audio-player').addEventListener('ended', nextTrack);
</script>
</body>
</html>
